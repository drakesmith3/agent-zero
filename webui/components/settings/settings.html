<html>
<head>
  <title>Settings</title>
</head>

<body>
<script type="module">
  import { store as settingsStore } from "/components/settings/settings-store.js";
</script>

<div x-data>
  <template x-if="$store.settings">
    <div x-init="$store.settings.onOpen()" x-destroy="$store.settings.cleanup()">

      <!-- Loading state -->
      <div x-show="$store.settings.isLoading && !$store.settings.settings" class="settings-loading">
        <span class="material-symbols-outlined spinning">progress_activity</span>
        <span>Loading settings...</span>
      </div>

      <!-- Error state -->
      <div x-show="$store.settings.error && !$store.settings.settings" class="settings-error">
        <span class="material-symbols-outlined">error</span>
        <span x-text="$store.settings.error"></span>
        <button class="btn btn-retry" @click="$store.settings.onOpen()">Retry</button>
      </div>

      <!-- Settings content -->
      <div x-show="$store.settings.settings" class="settings-content">
        <!-- Tab Navigation -->
        <div class="settings-tabs-container">
          <div class="settings-tabs-toolbar">
            <input type="search" class="settings-tab-filter" placeholder="Find section" x-model.trim="$store.settings.tabFilter" @input="$store.settings.setTabFilter($event.target.value)" @keydown.escape="$store.settings.setTabFilter('')" aria-label="Find settings section" />
            <button type="button" class="settings-tab-clear" x-show="$store.settings.tabFilter" @click="$store.settings.setTabFilter('')" title="Clear settings filter">Clear</button>
          </div>
          <div class="settings-tabs no-scrollbar">
            <div class="settings-tab"
                 x-show="$store.settings.filteredTabs.includes('agent')"
                 :class="{'active': $store.settings.activeTab === 'agent'}"
                 @click="$store.settings.switchTab('agent')"
                 title="Agent Settings">Agent Settings</div>
            <div class="settings-tab"
                 x-show="$store.settings.filteredTabs.includes('skills')"
                 :class="{'active': $store.settings.activeTab === 'skills'}"
                 @click="$store.settings.switchTab('skills')"
                 title="Skills">Skills</div>
            <div class="settings-tab"
                 x-show="$store.settings.filteredTabs.includes('external')"
                 :class="{'active': $store.settings.activeTab === 'external'}"
                 @click="$store.settings.switchTab('external')"
                 title="External Services">External Services</div>
            <div class="settings-tab" 
                 x-show="$store.settings.filteredTabs.includes('mcp')"
                 :class="{'active': $store.settings.activeTab === 'mcp'}"
                 @click="$store.settings.switchTab('mcp')" 
                 title="MCP">MCP/A2A</div>
            <div class="settings-tab" 
                 x-show="$store.settings.filteredTabs.includes('developer')"
                 :class="{'active': $store.settings.activeTab === 'developer'}"
                 @click="$store.settings.switchTab('developer')" 
                 title="Developer">Developer</div>
            <div class="settings-tab"
                 x-show="$store.settings.filteredTabs.includes('backup')"
                 :class="{'active': $store.settings.activeTab === 'backup'}"
                 @click="$store.settings.switchTab('backup')"
                 title="Backup & Restore">Backup & Restore</div>
          </div>
          <div class="settings-tab-no-match" x-show="$store.settings.tabFilter && !$store.settings.hasTabFilterMatches">
            No settings sections match your filter.
          </div>
        </div>

        <!-- Settings sections for agent, external, developer, mcp, backup tabs -->
        <div id="settings-sections">
          <div x-show="$store.settings.activeTab === 'agent'">
            <x-component path="settings/agent/agent-settings.html"></x-component>
          </div>
          <div x-show="$store.settings.activeTab === 'external'">
            <x-component path="settings/external/external-settings.html"></x-component>
          </div>
          <div x-show="$store.settings.activeTab === 'mcp'">
            <x-component path="settings/mcp/mcp-settings.html"></x-component>
          </div>
          <div x-show="$store.settings.activeTab === 'developer'">
            <x-component path="settings/developer/developer-settings.html"></x-component>
          </div>
          <div x-show="$store.settings.activeTab === 'backup'">
            <x-component path="settings/backup/backup-settings.html"></x-component>
          </div>
          <div x-show="$store.settings.activeTab === 'skills'">
            <x-component path="settings/skills/skills-settings.html"></x-component>
          </div>
          <div class="settings-tab-no-match" x-show="$store.settings.tabFilter && !$store.settings.hasTabFilterMatches">
            No settings sections match your filter.
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer" data-modal-footer x-show="$store.settings.settings">
        <button class="btn btn-ok" 
            @click="$store.settings.saveAndClose()"
            :disabled="$store.settings?.isLoading">
        Save
        </button>
        <button class="btn btn-cancel" 
                @click="$store.settings.closeSettings()">
          Cancel
        </button>
      </div>

    </div>
  </template>
</div>
</body>
</html>

<style>
.settings-loading,
.settings-error {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 2rem;
  color: var(--color-text-secondary, #999);
  font-size: 1rem;
}

.settings-error {
  flex-direction: column;
  color: var(--color-error, #e74c3c);
}

.settings-error .material-symbols-outlined {
  font-size: 2rem;
}

.settings-error .btn-retry {
  margin-top: 1rem;
}

.settings-content {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.spinning {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}


.settings-tabs-toolbar {
  margin-bottom: 0.55rem;
}

.settings-tab-filter {
  width: 100%;
  border: 1px solid var(--color-border);
  border-radius: 0.55rem;
  background: color-mix(in srgb, var(--color-panel) 86%, transparent);
  color: var(--color-text);
  padding: 0.45rem 0.6rem;
  font-size: 0.82rem;
}

.settings-tab-clear {
  margin-top: 0.45rem;
  border: 1px solid var(--color-border);
  border-radius: 0.45rem;
  background: transparent;
  color: var(--color-text-muted);
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  cursor: pointer;
}

.settings-tab-no-match {
  margin-top: 0.5rem;
  color: var(--color-text-muted);
  font-size: 0.8rem;
  font-style: italic;
}

</style>

